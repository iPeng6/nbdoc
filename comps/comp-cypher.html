<template component>
  <style>
    :host {
      --bg-color: #fff;
      --border-color: #d0d7deb3;
      --btn-bg: #070808;
      --text: white;
    }


    .container {
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }

    .container .input {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      position: relative;
    }

    textarea {
      height: 200px;
      margin-bottom: 16px;
      padding: 12px;
      font-size: 16px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      resize: vertical;
      transition: border-color 0.3s ease;
      line-height: 1.5;
    }

    textarea:focus {
      outline: none;
      border-color: #2196F3;
      box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
    }

    button {
      padding: 10px 20px;
      font-size: 15px;
      margin-right: 12px;
      border: none;
      border-radius: 6px;
      background-color: var(--btn-bg);
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      line-height: 1;
    }

    button:hover {
      background-color: #626363;
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
    }

    .output {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      margin-top: 20px;
      gap: 16px;
    }

    .output-text {
      position: relative;
      flex: 1;
      padding: 16px;
      font-size: 16px;
      border-radius: 8px;
      background-color: var(--bg-color);
      border: 2px solid var(--border-color);
    }

    .output-text pre {
      margin: 0;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .output-md {
      position: relative;
      flex: 1;
      padding: 16px;
      border-radius: 8px;
      border: 2px solid var(--border-color);
    }

    .copy {
      position: absolute;
      right: 4px;
      top: 4px;
      font-size: 12px;
      cursor: pointer;
      border: 1px solid var(--border-color);
      padding: 2px 4px;
      border-radius: 4px;
    }

    .copy.ok {
      color: #4caf50;
    }

    .clear {
      position: absolute;
      right: 4px;
      top: 4px;
      cursor: pointer;
      font-size: 12px;
      border: 1px solid var(--border-color);
      padding: 2px 4px;
      border-radius: 4px;
    }

    @media screen and (max-width: 768px) {
      .output {
        flex-direction: column;
      }
    }

    @media (prefers-color-scheme: dark) {
      :host {
        --border-color: #30363db3;
        --bg-color: #0d1117;
        --c-gray: #ccc;
        --btn-bg: #30363d;
        --text: #ccc;
      }
    }
  </style>
  <div class="container">
    <h2>å¯†è¯­ç¼–è§£ç å™¨</h2>
    <div class="input">
      <textarea name="source" id="source" placeholder="ä¸¾ä¾‹ï¼šå–ç‰¹ç‰¹å¡æ€å†’æ–œæ–œå“¥å–”å˜šå‘²å–”å˜šé¹…ç‚¹å±‹è¡£è®·æ–œ" sync:value="source"></textarea>
      <div class="clear" on:click="clear">Clear</div>
    </div>
    <div>
      <button on:click="decode">è§£ç </button>
      <button on:click="encode">ç¼–ç </button>
      <button on:click="up">ğŸ”ƒ</button>
    </div>
    <div class="output">
      <div class="output-text">
        <pre>{{output}}</pre>
        <div class="copy" on:click="copy(0)" class:ok="copyedFirst"><x-if
            :value="!copyedFirst">Copy</x-if><x-else>Success</x-else></div>
      </div>
      <div class="output-md">
        <l-md :md="output"></l-md>
        <div class="copy" on:click="copy(1)" class:ok="copyedSecond"><x-if
            :value="!copyedSecond">Copy</x-if><x-else>Success</x-else></div>
      </div>
    </div>
  </div>
  <script>
    const mapping = {
      'a': 'é˜¿', 'b': 'ç»', 'c': 'å‘²', 'd': 'å˜š', 'e': 'é¹…', 'f': 'å¤«', 'g': 'å“¥', 'h': 'å–',
      'i': 'è¡£', 'j': 'é¸¡', 'k': 'ç§‘', 'l': 'å‹’', 'm': 'æ‘¸', 'n': 'è®·', 'o': 'å–”', 'p': 'å¡',
      'q': 'å¦»', 'r': 'æ—¥', 's': 'æ€', 't': 'ç‰¹', 'u': 'ä¹Œ', 'v': 'å¾®', 'w': 'å±‹', 'x': 'è¥¿',
      'y': 'ä¼Š', 'z': 'èµ„',
      "A": "å•Š", "B": "æ’­", "C": "åƒ", "D": "çš„", "E": "é¢", "F": "ä½›", "G": "å’¯", "H": "å‘µ",
      "I": "åŒ»", "J": "å‡»", "K": "æ£µ", "L": "ä¹", "M": "æŠ¹", "N": "å‘", "O": "å™¢", "P": "æ³¼",
      "Q": "æœŸ", "R": "çƒ­", "S": "ä¸", "T": "å¿‘", "U": "å””", "V": "è–‡", "W": "çª", "X": "å¸",
      "Y": "ä¾", "Z": "æ»‹",
      '0': 'é›¶', '1': 'ä¸€', '2': 'äºŒ', '3': 'ä¸‰', '4': 'å››', '5': 'äº”', '6': 'å…­', '7': 'ä¸ƒ', '8': 'å…«', '9': 'ä¹',
      '.': 'ç‚¹', '/': 'æ–œ', ':': 'å†’', '-': 'æ ', '_': 'ä¸‹', '=': 'ç­‰', '?': 'é—®', '&': 'å’Œ',
      '!': 'å¹', '@': 'åœˆ', '#': 'äº•', '$': 'åˆ€', '%': 'ç™¾', '^': 'å¸½', '*': 'æ˜Ÿ', '(': 'å·¦', ')': 'å³',
      '+': 'åŠ ', '\'': 'æ’‡', '"': 'åŒ', ';': 'åˆ†', '<': 'å°', '>': 'å¤§', ',': 'é€—', ' ': 'ç©º',
      '[': 'ä½', ']': 'ä½‘', '{': 'æ‹¬', '}': 'ç¼©', '\\': 'å', '|': 'ç«–', '`': 'é¡¿', '~': 'æ³¢'
      // å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šå­—ç¬¦çš„æ˜ å°„
    };
    // åå‘æ˜ å°„
    const reverseMapping = Object.keys(mapping).reduce((acc, key) => {
      acc[mapping[key]] = key;
      return acc;
    }, {});

    function encodeURL(url) {
      let encoded = "";
      for (const char of url) {
        encoded += mapping[char] || char; // å¦‚æœæ²¡æœ‰æ˜ å°„ï¼Œä¿ç•™åŸå­—ç¬¦
      }
      return encoded;
    }

    function decodeURL(encodedURL) {


      let decoded = "";
      for (let i = 0; i < encodedURL.length; i++) {
        decoded += reverseMapping[encodedURL[i]] || encodedURL[i]; // å¦‚æœæ²¡æœ‰æ˜ å°„ï¼Œä¿ç•™åŸå­—ç¬¦
      }
      return decoded;
    }


    function convertUrls(text) {
      const urlRegex = /https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*/g;

      return text.replace(urlRegex, (url) => {
        return encodeURL(url)
      });
    }
    function convertUrlsBack(text) {


      // éå† a-zA-Z0-9
      //  'a' - 'z': 97 - 122
      // 'A' - 'Z': 65 - 90
      // '0' - '9': 48 - 57
      let cnChars = [];
      let cnNums = [];
      for (let i = 0; i < 26; i++) {
        cnChars.push(mapping[String.fromCharCode(97 + i)]);
        cnChars.push(mapping[String.fromCharCode(65 + i)]);
      }
      for (let i = 0; i < 10; i++) {
        cnNums.push(mapping[String.fromCharCode(48 + i)]);
      }
      const allChars = `${cnChars.concat(cnNums).join('|')}|ä¸‹|æ `
      // const urlRegex = /https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*/g;
      const urlRegex = new RegExp(`å–ç‰¹ç‰¹å¡æ€?å†’æ–œæ–œ(([${allChars}])+(ç‚¹)?)*(å†’[${cnNums.join('|')}]+)?(æ–œ(ç‚¹?é—®?ç­‰?å’Œ?[${allChars}]é—®?)*)*`, 'g') // /å–ç‰¹ç‰¹å¡æ€?å†’æ–œæ–œ(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*/


      return text.replace(urlRegex, (url) => {
        return decodeURL(url)
      });
    }
    const defaultText = 'ä¸¾ä¾‹ï¼šhttps://godcode.win/';
    export default {
      data: {
        source: '',
        output: defaultText,
        copyedFirst: false,
        copyedSecond: false
      },
      watch: {
        source(val) {
          if (val === '') {
            this.output = defaultText
          }
        }
      },
      proto: {
        encode() {
          this.output = convertUrls(this.source)
        },
        decode() {
          this.output = convertUrlsBack(this.source)
        },
        up() {
          this.source = this.output;
          this.output = ''
        },
        copy(n) {
          navigator.clipboard.writeText(this.output)
          // toast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
          if (n === 0) {
            this.copyedFirst = true
            setTimeout(() => {
              this.copyedFirst = false
            }, 2000);
          } else {
            this.copyedSecond = true
            setTimeout(() => {
              this.copyedSecond = false
            }, 2000);
          }
        },
        clear() {
          this.source = ''
        }
      }
    }
  </script>
</template>