<template page>
  <style>
    :host {
      display: block;
      width: 100%;
      height: 100%;
      overflow-y: auto;
    }

    .sidebar {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      width: 300px;
      padding: 0 16px;

      border-right: 1px solid rgba(0, 0, 0, 0.07);
      overflow-y: auto;
      z-index: 20;
    }

    .main {
      padding-top: 50px;
      padding-left: 300px;
      padding-bottom: 60px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 8px 0;
      font-size: 20px;
      font-weight: 600;
      border-bottom: 1px solid rgba(0, 0, 0, 0.07);
    }
    .logo {
      /* border: 2px solid rgb(163, 163, 248); */
      border-radius: 100%;
      box-shadow: 0 0 10px rgb(115, 115, 249);
    }
    .nick-name {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      font-size: 34px;
      background: linear-gradient(20deg, #fd3939, #ff7f00, #afaf82, #fec2c2);
      background-clip: text;
      --webkt-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .menu {
      padding-top: 16px;
    }
  </style>

  <div class="container">
    <div class="sidebar">
      <div class="header">
        <img
          class="logo"
          src="./static/dylogo.png"
          alt="抖音：神农尝百码"
          width="88"
          height="88"
        />
        <a class="nick-name" href="/">神农尝百码</a>
      </div>
      <div class="menu">
        <l-md src="./doc/sidebar.md" :ready="lmdReady"></l-md>
      </div>
    </div>
    <div class="main">
      <slot></slot>
    </div>
  </div>
  <script>
    export default {
      data: {
        currentPage: "",
      },
      proto: {
        syncActive() {
          const urlParams = new URLSearchParams(location.search);
          const p = urlParams.get("p");
          setTimeout(() => {
            const lmd = this.shadow.$("l-md").shadow;
            if (p) {
              const active = lmd.$(
                'li:has(> a[href="./page.html?p=' + p + '"])',
              );
              if (active) {
                lmd.all("li").forEach((li) => {
                  li.classList.remove("active");
                });

                active.classList.add("active");
              }
            }
          }, 100);
        },
        lmdReady(ins) {
          // inject menu css
          const link = $('<link rel="stylesheet" href="./static/menu.css">');
          ins.shadow.unshift(link);
        },
      },
      ready() {
        this.lmdReady = this.lmdReady.bind(this);
      },
      attached() {
        this.syncActive();
      },
      routerChange() {
        this.syncActive();
      },
    };
  </script>
</template>
